<?php \Theme::instance()->set_partial('page-header', \Theme::instance()->view('admin/users/page-headers/details')); ?>

<div class="row">
  <div class="col-md-10">
    <section class="panel">
      <header class="panel-heading"><?php echo html_tag('span', array('class' => 'h4'), __('auth.user.page-title.details', array('name' => e($user->username)))); ?></header>
      <?php
      
      \Package::load('table');
      
      $table = \Table\Table::forge()->set_attribute('class', 'table table-striped table-hover');
      
      $table->get_body()->add_row(array(
        \Table\Cell::forge(__('auth.model.user.username'), array(), \Table\Cell::HEADER),
        \Table\Cell::forge(e($user->username), array(), \Table\Cell::BODY)
      ));
      
      $table->get_body()->add_row(array(
        \Table\Cell::forge(__('auth.model.user.email'), array(), \Table\Cell::HEADER),
        \Table\Cell::forge(
          e($user->email)
          . ' '
          . html_tag(
            'span',
            array(
              'class' => 'pull-right clearfix',
            ),
            \Html::mail_to_safe(
              $user->email,
              '<i class="icon-envelope-alt"></i>',
              null,
              array(
                'class'       => 'btn btn-default btn-xs',
                'data-toggle' => 'tooltip',
                'title'       => __('global.send_email'),
              )
            )
          ),
          array(),
          \Table\Cell::BODY)
      ));
      
      $table->get_body()->add_row(array(
        \Table\Cell::forge(__('auth.model.user.group_id'), array(), \Table\Cell::HEADER),
        \Table\Cell::forge(e($user->group->name), array(), \Table\Cell::BODY)
      ));
      
      $table->get_body()->add_row(array(
        \Table\Cell::forge(__('auth.model.user.created_at'), array(), \Table\Cell::HEADER),
        \Table\Cell::forge(\Date::time_ago($user->created_at), array(), \Table\Cell::BODY)
      ));
      
      $table->get_body()->add_row(array(
        \Table\Cell::forge(__('auth.model.user.updated_at'), array(), \Table\Cell::HEADER),
        \Table\Cell::forge(
          $user->updated_at
          ? \Date::time_ago($user->updated_at)
            . ' '
            . __('global.by')
            . ' '
            . (
              \Auth::has_access('users.admin[read]')
              ? ( $user->auditor
                ? \Html::anchor('admin/auth/users/details/' . $user->auditor->id, e($user->auditor->username) . '&nbsp;<i class="icon-share-alt"></i>', array('class' => 'text-primary'))
                : __('global.n/a')
              )
              : ( $user->auditor
                ? e($user->auditor->username)
                : __('global.n/a')
              )
            )
          : __('global.never'),
          array(),
          \Table\Cell::BODY
        )
      ));
      
      echo $table;
      
      ?>
    </section>
  </div>
  <div class="col-md-2">
    <section class="panel">
      <header class="panel-heading bg-primary lter"><?php echo html_tag('span', array('class' => 'h5'), __('global.navigation')); ?></header>
      <div class="list-group">
        <?php
          echo \Html::anchor(
            'admin/auth/users',
            '<i class="icon-double-angle-left icon-fixed-width"></i>&nbsp;&nbsp;' . __('button.list'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
        <?php
          echo \Html::anchor(
            'admin/auth/users/create',
            '<i class="icon-plus icon-fixed-width"></i>&nbsp;&nbsp;' . __('button.new'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
        <?php
          echo \Html::anchor(
            'admin/auth/users/update/' . $user->id,
            '<i class="icon-pencil icon-fixed-width"></i>&nbsp;&nbsp;' . __('button.edit'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
        <?php
          if ( $user->is_deletable() )
          {
            echo \Html::anchor(
              'admin/auth/users/delete/' . $user->id,
              '<i class="icon-trash icon-fixed-width"></i>&nbsp;&nbsp;' . __('button.delete'),
              array(
                'class'   => 'list-group-item',
              )
            );
          }
        ?>
        <?php
          echo \Html::anchor(
            'admin/auth/permissions/users/' . $user->id,
            '<i class="icon-legal icon-fixed-width"></i>&nbsp;&nbsp;' . __('button.permissions'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
      </div>
    </section>
  </div>
</div>

<div class="row">
  <div class="col-xs-4 col-md-4">
    <section class="panel">
      <header class="panel-heading bg-light dk"><span class="h4"><i class="icon-file icon-fixed-width"></i>&nbsp;&nbsp;Metadata</span></header>
      <div class="list-group scrollable alt">
        <?php if ( $user->metadata ) : ?>
          <?php foreach ( $user->metadata as $metadata ) : ?>
            <div class="list-group-item">
              <small class="text-uc text-muted"><?php echo __('auth.model.user.metadata.' . $metadata->attribute); ?></small>
              <p><?php echo e($metadata->value); ?></p>
            </div>
          <?php endforeach; ?>
        <?php else : ?>
          <?php echo html_tag('span', array('class' => 'list-group-item',), 'No roles assigned this user.'); ?>
        <?php endif; ?>
      </div>
    </section>
  </div>
  
  <div class="col-xs-4 col-md-4">
    <section class="panel">
      <header class="panel-heading bg-light dk"><span class="h4"><i class="icon-group icon-fixed-width"></i>&nbsp;&nbsp;Roles</span></header>
      <div class="list-group scrollable">
        <?php if ( $user->roles ) : ?>
          <?php foreach ( $user->roles as $role ) : ?>
            <?php
            echo \Html::anchor(
              'admin/auth/roles/details/'
              . $role->id,
              '<i class="icon-chevron-right"></i>'
              . e($role->name),
              array(
                'class' => 'list-group-item'
              )
            );
            ?>
            
          <?php endforeach; ?>
        <?php else : ?>
          <?php echo html_tag('span', array('class' => 'list-group-item',), 'No roles assigned this user.'); ?>
        <?php endif; ?>
      </div>
    </section>
  </div>
  
  <div class="col-xs-4 col-md-4">
    <section class="panel">
      <header class="panel-heading bg-light dk"><span class="h4"><i class="icon-legal icon-fixed-width"></i>&nbsp;&nbsp;Permissions</span></header>
      <div class="list-group scrollable">
        <?php if ( $user->userpermissions ) : ?>
          <?php foreach ( $user->userpermissions as $user_perm ) : ?>
            <?php echo html_tag('span', array('class' => 'list-group-item'), e($user_perm->permission->area) . '<i class="icon-chevron-right"></i>' . e($user_perm->permission->permission)); ?>
            
          <?php endforeach; ?>
        <?php else : ?>
          <?php echo html_tag('span', array('class' => 'list-group-item',), 'No permissions assigned this user.'); ?>
        <?php endif; ?>
      </div>
    </section>
  </div>
</div>
