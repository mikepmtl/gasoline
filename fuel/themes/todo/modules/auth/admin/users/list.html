<?php \Theme::instance()->set_partial('page-header', \Theme::instance()->view('admin/users/page-headers/list')); ?>

<div class="row">
  <div class="col-md-10">
    <section class="panel">
      <header class="panel-heading"><?php echo html_tag('span', array('class' => 'h4'), __('user.page-title.list')); ?></header>
      <?php if ( count($table) ) : ?>
        <div class="table-responsive">
          <?php
          $table->set_attribute('class', 'table table-striped table-hover');
          
          $engine = new \Gasform\Render_Bootstrap();
          
          foreach ( $table as $row )
          {
            $cbx = $row[0]->get_content();
            $row[0]->set_content($cbx->render($engine));
            
            if ( ! ( $user = $row->get_meta('user') ) )
            {
              continue;
            }
            
            $tools = array();
            
            if ( \Auth::has_access('users.admin[read]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/users/details/' . $user->id,
                '<i class="icon-eye-open"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            if ( \Auth::has_access('users.admin[update]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/users/update/' . $user->id,
                '<i class="icon-pencil"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            if ( $user->is_deletable() && \Auth::has_access('users.admin[delete]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/users/delete/' . $user->id,
                '<i class="icon-trash"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            $row[count($row) - 1]->set_content(html_tag('div', array('class' => 'btn-group'), implode('', $tools)));
          }
          
          echo $table;
          ?>
        </div>
        <?php else : ?>
        <div class="panel-body">
          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <section class="panel text-center no-border bg-warning dker">
                <div class="panel-body">
                  <p><i class="icon-exclamation-sign icon-4x"></i></p>
                  <p class="h5"><?php echo __('global.no_data'); ?></p>
                </div>
              </section>
            </div>
          </div>
        </div>
        <?php endif; ?>
      <footer class="panel-footer">
        <div class="row">
          <!-- bulk actions -->
          <div class="col-md-4">
            
          </div>
          <!-- /bulk-actions -->
          <!-- page-info -->
          <div class="col-md-4">
          
          </div>
          <!-- /page-info -->
          <!-- pagination -->
          <div class="col-md-4 text-right text-center-xs">
            <?php echo ( isset($pagination) ? $pagination->render() : '' ); ?>
          </div>
          <!-- /pagination -->
        </div>
      </footer>
    </section>
  </div>
  <div class="col-md-2">
    <section class="panel">
      <header class="panel-heading bg-primary lter"><?php echo html_tag('span', array('class' => 'h5'), __('global.navigation')); ?></header>
      <div class="list-group">
        <?php
        echo \Html::anchor(
            'admin/auth',
            '<i class="icon-double-angle-left icon-fixed-width"></i>' . __('auth.page-title.section'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
        <?php
          echo \Html::anchor(
            'admin/auth/users/create',
            '<i class="icon-plus icon-fixed-width"></i>' . __('button.new'),
            array(
              'class'   => 'list-group-item',
            )
          );
        ?>
      </div>
    </section>
  </div>
</div>
