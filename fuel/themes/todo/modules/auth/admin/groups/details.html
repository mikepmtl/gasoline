<?php \Theme::instance()->set_partial('page-header', \Theme::instance()->view('admin/_partials/page-header')); ?>

<div class="row">
  <div class="col-md-10">
    <section class="panel">
      <header class="panel-heading"><?php echo html_tag('h4', array('class' => 'panel-title'), __('auth.navigation.admin.group.page-title.details', array('name' => html_tag('small', array(), e($group->name))))); ?></header>
      <?php
      
      \Package::load('table');
      
      $table = \Table\Table::forge(array('class' => 'table table-striped table-responsive table-hover'));
      
      $table[] = \Table\Row::forge(array(
        \Table\Cell::forge(__('auth.model.group.name'))->set_type(\Table\Cell::HEADER),
        \Table\Cell::forge(e($group->name))
      ));
      
      $table[] = \Table\Row::forge(array(
        \Table\Cell::forge(__('auth.model.group.slug'))->set_type(\Table\Cell::HEADER),
        \Table\Cell::forge(e($group->slug))
      ));
      
      $table[] = \Table\Row::forge(array(
        \Table\Cell::forge(__('auth.model.group.created_at'))->set_type(\Table\Cell::HEADER),
        \Table\Cell::forge(html_tag('span', array('data-toggle' => 'tooltip', 'title' => \Date::forge($group->created_at)->format(), 'data-placement' => 'right'), \Date::time_ago($group->created_at)))
      ));
      
      $table[] = \Table\Row::forge(array(
        \Table\Cell::forge(__('auth.model.group.updated_at'))->set_type(\Table\Cell::HEADER),
        \Table\Cell::forge(
          $group->updated_at
          ? \Date::time_ago($group->updated_at)
            . ' '
            . __('global.by')
            . ' '
            . (
              \Auth::has_access('auth.admin:users[read]')
              ? ( $group->auditor
                ? \Html::anchor('admin/auth/users/details/' . $group->auditor->username, e($group->auditor->username) . '&nbsp;<i class="fa fa-share-alt"></i>', array('class' => 'text-primary'))
                : __('global.n/a')
              )
              : ( $group->auditor
                ? e($group->auditor->username)
                : __('global.n/a')
              )
            )
          : __('global.never')
        )
      ));
      
      echo $table->render();
      
      ?>
    </section>
  </div>
  <div class="col-md-2">
    <section class="panel">
      <header class="panel-heading bg-primary lter"><?php echo html_tag('h4', array('class' => 'panel-title'), __('global.navigation')); ?></header>
      <div class="list-group">
        <?php if ( \Auth::has_access('auth.admin:groups[list]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/groups',
              '<i class="fa fa-angle-double-left fa-fw"></i>&nbsp;&nbsp;' . __('button.list'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
        <?php if ( \Auth::has_access('auth.admin:groups[create]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/groups/create',
              '<i class="fa fa-plus fa-fw"></i>&nbsp;&nbsp;' . __('button.new'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
        <?php if ( \Auth::has_access('auth.admin:groups[update]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/groups/update/' . $group->slug,
              '<i class="fa fa-pencil fa-fw"></i>&nbsp;&nbsp;' . __('button.edit'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
        <?php if ( $group->is_deletable() && \Auth::has_access('auth.admin:groups[delete]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/groups/delete/' . $group->slug,
              '<i class="fa fa-trash-o fa-fw"></i>&nbsp;&nbsp;' . __('button.delete'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
        <?php if ( \Auth::has_access('auth.admin:permissions[group]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/permissions/groups/' . $group->slug,
              '<i class="fa fa-legal fa-fw"></i>&nbsp;&nbsp;' . __('button.permissions'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
      </div>
    </section>
  </div>
</div>

<div class="row">
  <?php if ( \Auth::has_access('auth.admin:users[list]') ) : ?>
    <div class="col-sm-4 col-md-4">
      <section class="panel">
        <header class="panel-heading bg-light dk"><h4 class="panel-title"><i class="fa fa-user fa-fw"></i>&nbsp;&nbsp;<?php echo __('auth.model.group.users'); ?></h4></header>
        <div class="list-group scrollable">
          <?php if ( $group->users ) : ?>
            <?php foreach ( $group->users as $user ) : ?>
              <?php if ( \Auth::has_access('auth.admin:users[read]') ) : ?>
                <?php
                  echo \Html::anchor(
                    'admin/auth/users/details/'
                    . $user->username,
                    '<i class="fa fa-chevron-right fa-fw"></i>'
                    . e($user->username),
                    array(
                      'class' => 'list-group-item'
                    )
                  );
                ?>
              <?php else : ?>
                <?php
                  echo \Html::anchor(
                    '#',
                    '<i class="fa fa-chevron-right fa-fw"></i>'
                    . e($user->username),
                    array(
                      'class' => 'list-group-item'
                    )
                  );
                ?>
              <?php endif; ?>
            <?php endforeach; ?>
          <?php else : ?>
            <?php echo html_tag('span', array('class' => 'list-group-item',), 'No users assigned this group.'); ?>
          <?php endif; ?>
        </div>
      </section>
    </div>
  <?php endif; ?>
  
  <?php if ( \Auth::has_access('auth.admin:roles[list]') ) : ?>
    <div class="col-sm-4 col-md-4">
      <section class="panel">
        <header class="panel-heading bg-light dk"><h4 class="panel-title"><i class="fa fa-group fa-fw"></i>&nbsp;&nbsp;<?php echo __('auth.model.group.roles'); ?></h4></header>
        <div class="list-group scrollable">
          <?php if ( $group->roles ) : ?>
            <?php foreach ( $group->roles as $role ) : ?>
              <?php if ( \Auth::has_access('auth.admin:roles[read]') ) : ?>
                <?php
                  echo \Html::anchor(
                    'admin/auth/roles/details/'
                    . $role->slug,
                    '<i class="fa fa-chevron-right fa-fw"></i>'
                    . e($role->name),
                    array(
                      'class' => 'list-group-item'
                    )
                  );
                ?>
              <?php else : ?>
                <?php
                  echo \Html::anchor(
                    '#',
                    '<i class="fa fa-chevron-right fa-fw"></i>'
                    . e($role->name),
                    array(
                      'class' => 'list-group-item'
                    )
                  );
                ?>
              <?php endif; ?>
            <?php endforeach; ?>
          <?php else : ?>
            <?php echo html_tag('span', array('class' => 'list-group-item',), 'No roles assigned this group.'); ?>
          <?php endif; ?>
        </div>
      </section>
    </div>
  <?php endif; ?>
  
  <?php if ( \Auth::has_access('auth.admin:permissions[group]') ) : ?>
    <div class="col-sm-4 col-md-4">
      <section class="panel">
        <header class="panel-heading bg-light dk"><h4 class="panel-title"><i class="fa fa-legal fa-fw"></i>&nbsp;&nbsp;<?php echo __('auth.model.group.grouppermissions'); ?></h4></header>
        <div class="list-group scrollable">
          <?php if ( $group->grouppermissions ) : ?>
            <?php foreach ( $group->grouppermissions as $group_perm ) : ?>
              <?php echo html_tag('span', array('class' => 'list-group-item'), e($group_perm->permission->area) . '<i class="fa fa-chevron-right fa-fw"></i>' . e($group_perm->permission->permission)); ?>
            <?php endforeach; ?>
          <?php else : ?>
            <?php echo html_tag('span', array('class' => 'list-group-item',), 'No permissions assigned this group.'); ?>
          <?php endif; ?>
        </div>
      </section>
    </div>
  <?php endif; ?>
</div>
