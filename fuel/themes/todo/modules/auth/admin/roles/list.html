<?php \Theme::instance()->set_partial('page-header', \Theme::instance()->view('admin/_partials/page-header')); ?>

<?php $engine = new \Gasform\Render_Bootstrap(); ?>
<?php $simple_engine = new \Gasform\Render_Simple(); ?>

<div class="row">
  <div class="col-md-10">
    <section class="panel">
      <header class="panel-heading"><?php echo html_tag('h4', array('class' => 'panel-title'), __('auth.navigation.admin.role.page-title.list')); ?></header>
      <?php if ( count($table) ) : ?>
        <?php echo \Form::open('admin/auth/roles/action'); ?>
        <div class="table-responsive">
          <?php
          $table->set_attribute('class', 'table table-striped table-hover');
          
          foreach ( $table->get_data() as $row )
          {
            $row['cbx']->set_content($simple_engine->render($row['cbx']->get_content()));
            
            if ( ! ( $role = $row->get_meta('role') ) )
            {
              continue;
            }
            
            $tools = array();
            
            if ( \Auth::has_access('auth.admin:roles[read]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/roles/details/' . $role->slug,
                '<i class="fa fa-info"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            if ( \Auth::has_access('auth.admin:roles[update]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/roles/update/' . $role->slug,
                '<i class="fa fa-pencil"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            if ( $role->is_deletable() && \Auth::has_access('auth.admin:roles[delete]') )
            {
              $tools[] = \Html::anchor(
                'admin/auth/roles/delete/' . $role->slug,
                '<i class="fa fa-trash-o"></i>',
                array(
                  'class' => 'btn btn-default btn-xs',
                )
              );
            }
            
            $row['actions']->set_content(html_tag('div', array('class' => 'btn-group'), implode('', $tools)));
          }
          
          echo $table->render();
          ?>
        </div>
        <footer class="panel-footer">
          <div class="row">
            <!-- bulk actions -->
            <div class="col-md-4 hidden-xs">
              <div class="input-group">
                <?php
                  $form['bulk_action']->set_attribute('class', 'input-sm form-control input-s-sm inline');
                  echo $simple_engine->render($form['bulk_action']);
                ?>
                <span class="input-group-btn">
                <?php
                  $form['submit']->set_attribute('class', 'btn btn-primary btn-sm');
                  echo $simple_engine->render($form['submit']);
                ?>
                </span>
              </div>
            </div>
            <!-- /bulk-actions -->
            
            <!-- page-info -->
            <div class="col-md-4 text-center hidden-xs">
              <?php if ( isset($pagination) ) : ?>
                <small class="text-muted inline m-t-sm m-b-sm">showing <?php echo ( ( $pagination->current_page - 1 )*$pagination->per_page + 1 ); ?>&ndash;<?php echo ( $pagination->total_items > ( $pagination->current_page*$pagination->per_page ) ? $pagination->current_page * $pagination->per_page : $pagination->total_items ); ?> of <?php echo $pagination->total_items; ?> items</small>
              <?php endif; ?>
            </div>
            <!-- /page-info -->
            
            <!-- pagination -->
            <div class="col-md-4 text-right text-center-xs">
              <?php echo ( isset($pagination) ? $pagination->render() : '' ); ?>
            </div>
            <!-- /pagination -->
          </div>
        </footer>
        <?php echo \Form::close(); ?>
      <?php else : ?>
        <div class="panel-body">
          <div class="row">
            <div class="col-md-6 col-md-offset-3">
              <section class="panel text-center no-border bg-warning dker">
                <div class="panel-body">
                  <p><i class="fa fa-exclamation-triangle fa-4x"></i></p>
                  <p class="h5"><?php echo __('global.no_data'); ?></p>
                </div>
              </section>
            </div>
          </div>
        </div>
        <?php endif; ?>
    </section>
  </div>
  <div class="col-md-2">
    <section class="panel">
      <header class="panel-heading bg-primary lter"><?php echo html_tag('h4', array('class' => 'panel-title'), __('global.navigation')); ?></header>
      <div class="list-group">      
        <?php if ( \Auth::has_access('auth.admin') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth',
              '<i class="fa fa-angle-double-left fa-fw"></i>&nbsp;' . __('auth.navigation.page-title._section'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
        <?php if ( \Auth::has_access('auth.admin:roles[create]') ) : ?>
          <?php
            echo \Html::anchor(
              'admin/auth/roles/create',
              '<i class="fa fa-plus fa-fw"></i>&nbsp;' . __('button.new'),
              array(
                'class'   => 'list-group-item',
              )
            );
          ?>
        <?php endif; ?>
      </div>
    </section>
  </div>
</div>
